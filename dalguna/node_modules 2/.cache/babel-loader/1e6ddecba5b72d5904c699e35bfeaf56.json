{"ast":null,"code":"import _slicedToArray from\"/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import RestTitleBox from'../components/RestTitleBox.js';import dhspic from'../img/DHS_photo.jpeg';import MenuListItem from'../components/MenuListItem';import RestTab from'../components/RestTab.js';import TabBar from'../components/TabBar.js';import CartButton from'../components/CartButton.js';import MenuModal from'../components/MenuModal.js';import CartModal from'../components/CartModal.js';import RoomCard from'../components/RoomCard.js';import staticDB from\"../db/static.json\";import{collection,onSnapshot,getDoc,doc}from\"firebase/firestore\";import{db}from\"../firebase-config.js\";import'../rest-page.css';import{AiOutlineArrowLeft}from\"react-icons/ai\";function RestaurantPage(){var params=useParams();var userId=params.userId,restId=params.restId;var navigate=useNavigate();// const arrRestName = [\"대학생 치킨\", \"베리신주쿠\", \"마쯔미\"];\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),roomIdUserJoining=_useState2[0],setRoomIdUserJoining=_useState2[1];var _useState3=useState(\"restPage\"),_useState4=_slicedToArray(_useState3,2),classNameRestPage=_useState4[0],setClassNameRestPage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),deliAddr=_useState6[0],setDeliAddr=_useState6[1];var _useState7=useState(staticDB[params.restId]),_useState8=_slicedToArray(_useState7,2),restInfo=_useState8[0],setRestInfo=_useState8[1];var _useState9=useState(restInfo.menu),_useState10=_slicedToArray(_useState9,2),menuItemInfo=_useState10[0],setMenuItemInfo=_useState10[1];var _useState11=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState12=_slicedToArray(_useState11,2),modal=_useState12[0],setModal=_useState12[1];function openMenuModal(menu){setModal(/*#__PURE__*/React.createElement(MenuModal,{menuInfo:menu,restName:restInfo.name,setModal:setModal,cartItem:cartItem,setCartItem:setCartItem}));}function handleCartItemUpdate(){if(document.getElementsByClassName(\"restPage\")[0].previousSibling!==null&&document.getElementsByClassName(\"restPage\")[0].previousSibling.className===\"CartModal__\"){setModal(/*#__PURE__*/React.createElement(CartModal,{restName:restInfo.name,menuList:cartItem,setMenuList:setCartItem,setModal:setModal,roomList:roomList/*roomLength={roomInfo.length}*/,roomInfo:roomInfo,roomIdUserJoining:roomIdUserJoining,deliAddr:deliAddr}));}}var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),cartItem=_useState14[0],setCartItem=_useState14[1];useEffect(handleCartItemUpdate,[cartItem]);function openCartModal(){setModal(/*#__PURE__*/React.createElement(CartModal,{restName:restInfo.name,menuList:cartItem,setMenuList:setCartItem,setModal:setModal,roomList:roomList/*roomLength={roomInfo.length}*/,roomInfo:roomInfo,roomIdUserJoining:roomIdUserJoining,deliAddr:deliAddr}));}var menuList=menuItemInfo.map(function(menu){return/*#__PURE__*/React.createElement(\"li\",{key:menu.id,style:{listStyle:'none'},className:\"mainPage__menu-item\"},/*#__PURE__*/React.createElement(\"a\",{onClick:function onClick(){return openMenuModal(menu);}},\" \",/*#__PURE__*/React.createElement(MenuListItem,{menuItemInfo:menu})));});var info=/*#__PURE__*/React.createElement(\"div\",{className:\"restPage__info\"},/*#__PURE__*/React.createElement(\"p\",{className:\"restPage__info-text\"},restInfo.info),/*#__PURE__*/React.createElement(\"div\",{className:\"restPage__info-opening\"},/*#__PURE__*/React.createElement(\"p\",null,\"Open at \",restInfo.open),/*#__PURE__*/React.createElement(\"p\",null,\"Close at \",restInfo.close)));var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),roomInfo=_useState16[0],setRoomInfo=_useState16[1];function getRooms(){getDoc(doc(db,\"users\",userId)).then(function(user){setDeliAddr(user.data().addr);if(user.data().curRoomId!==\"\"){setRoomIdUserJoining(user.data().curRoomId);getDoc(doc(db,\"rooms\",user.data().curRoomId)).then(function(room){var _room$data=room.data(),restName=_room$data.restName,addr=_room$data.addr,ordStat=_room$data.ordStat,parti=_room$data.parti,endTime=_room$data.endTime;setRoomInfo([{'roomId':user.data().curRoomId,'restName':restName,'addr':addr,'ordStat':ordStat,'parti':parti,'endTime':endTime,'timeLeft':parseInt((endTime.seconds-new Date().getTime()/1000)/60),'rest':restInfo,'poolMon':parti.reduce(function(money,menu){return money+menu.price;},0)}]);});}else{onSnapshot(collection(db,\"rooms\"),function(snapshot){var tmp=[];snapshot.forEach(function(doc){return tmp.push({room:doc.data(),room_id:doc.id});});setRoomInfo(tmp.filter(function(el){return el.room.addr===user.data().addr;}).map(function(_ref){var room=_ref.room,room_id=_ref.room_id;return{'roomId':room_id,'restName':room.restName,'addr':room.addr,'ordStat':room.ordStat,'parti':room.parti,'endTime':room.endTime,'timeLeft':parseInt((room.endTime.seconds-new Date().getTime()/1000)/60),'rest':restInfo,'poolMon':room.parti.reduce(function(money,menu){return money+menu.price;},0)};}));});}});}useEffect(function(){getRooms();},[]);// for (const room of roomInfo) {\n//     room['rest'] = restInfo;\n// }\nvar _useState17=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState18=_slicedToArray(_useState17,2),roomList=_useState18[0],setRoomList=_useState18[1];useEffect(function(){setRoomList(roomInfo.filter(function(room){return room.restName==restInfo.name;}).map(function(room,i){return/*#__PURE__*/React.createElement(\"li\",{key:i,style:{listStyle:'none'}},/*#__PURE__*/React.createElement(\"div\",null,\" \",/*#__PURE__*/React.createElement(RoomCard,{roomInfo:room,photo:true})));}));if(roomInfo.filter(function(room){return room.restName==restInfo.name;}).length===0){setRoomList(/*#__PURE__*/React.createElement(\"p\",null,\"\\uB9CC\\uB4E4\\uC5B4\\uC9C4 \\uBC29\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"));}},[roomInfo]);var _useState19=useState(\"menu\"),_useState20=_slicedToArray(_useState19,2),curTab=_useState20[0],setCurTab=_useState20[1];var curTabContent={\"menu\":menuList,\"info\":info,\"room\":roomList};function goBack(){if(cartItem.length!=0){if(window.confirm(\"카트가 비워집니다. 뒤로 가시겠습니까?\")){navigate(-1);}}else{navigate(-1);}}return/*#__PURE__*/React.createElement(\"div\",{className:\"ui-container\"},modal,/*#__PURE__*/React.createElement(\"div\",{className:classNameRestPage},/*#__PURE__*/React.createElement(\"div\",{className:\"rest-title-image\",style:{backgroundImage:\"url(\".concat(restInfo.photo,\")\")}},/*#__PURE__*/React.createElement(\"div\",{className:\"rest-title\"},/*#__PURE__*/React.createElement(\"button\",{className:\"rest-title-back\",onClick:goBack},/*#__PURE__*/React.createElement(AiOutlineArrowLeft,null)),/*#__PURE__*/React.createElement(\"div\",null)),/*#__PURE__*/React.createElement(RestTitleBox,{restName:restInfo.name,restRating:\"5.0 (100)\"})),/*#__PURE__*/React.createElement(RestTab,{curTab:curTab,setCurTab:setCurTab}),/*#__PURE__*/React.createElement(\"ul\",{className:\"restPage__content-list\"},curTabContent[curTab]),/*#__PURE__*/React.createElement(CartButton,{cartItem:cartItem,onClick:openCartModal})));}export default RestaurantPage;","map":{"version":3,"sources":["/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/src/pages/RestaurantPage.js"],"names":["React","useState","useEffect","useParams","useNavigate","RestTitleBox","dhspic","MenuListItem","RestTab","TabBar","CartButton","MenuModal","CartModal","RoomCard","staticDB","collection","onSnapshot","getDoc","doc","db","AiOutlineArrowLeft","RestaurantPage","params","userId","restId","navigate","roomIdUserJoining","setRoomIdUserJoining","classNameRestPage","setClassNameRestPage","deliAddr","setDeliAddr","restInfo","setRestInfo","menu","menuItemInfo","setMenuItemInfo","modal","setModal","openMenuModal","name","cartItem","setCartItem","handleCartItemUpdate","document","getElementsByClassName","previousSibling","className","roomList","roomInfo","openCartModal","menuList","map","id","listStyle","info","open","close","setRoomInfo","getRooms","then","user","data","addr","curRoomId","room","restName","ordStat","parti","endTime","parseInt","seconds","Date","getTime","reduce","money","price","snapshot","tmp","forEach","push","room_id","filter","el","setRoomList","i","length","curTab","setCurTab","curTabContent","goBack","window","confirm","backgroundImage","photo"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom'\n\nimport RestTitleBox from '../components/RestTitleBox.js'\n\nimport dhspic from '../img/DHS_photo.jpeg';\nimport MenuListItem from '../components/MenuListItem';\nimport RestTab from '../components/RestTab.js';\nimport TabBar from '../components/TabBar.js';\nimport CartButton from '../components/CartButton.js';\nimport MenuModal from '../components/MenuModal.js';\nimport CartModal from '../components/CartModal.js';\nimport RoomCard from '../components/RoomCard.js';\n\nimport staticDB from \"../db/static.json\";\nimport { collection, onSnapshot, getDoc, doc } from \"firebase/firestore\";\nimport { db } from \"../firebase-config.js\";\n\nimport '../rest-page.css'\nimport { AiOutlineArrowLeft } from \"react-icons/ai\";\n\nfunction RestaurantPage() {\n  const params = useParams();\n  const { userId, restId } = params;\n  const navigate = useNavigate();\n  // const arrRestName = [\"대학생 치킨\", \"베리신주쿠\", \"마쯔미\"];\n\n  const [roomIdUserJoining, setRoomIdUserJoining] = useState(\"\");\n  const [classNameRestPage, setClassNameRestPage] = useState(\"restPage\");\n  const [deliAddr, setDeliAddr] = useState(\"\");\n\n  const [restInfo, setRestInfo] = useState(staticDB[params.restId])\n  const [menuItemInfo, setMenuItemInfo] = useState(restInfo.menu)\n  \n  const [modal, setModal] = useState(<></>)\n\n  function openMenuModal(menu) {\n    setModal(<MenuModal menuInfo={menu} restName={restInfo.name} setModal={setModal} cartItem={cartItem} setCartItem={setCartItem} ></MenuModal>)\n  }\n  \n  function handleCartItemUpdate() {\n    if (document.getElementsByClassName(\"restPage\")[0].previousSibling !== null \n      && document.getElementsByClassName(\"restPage\")[0].previousSibling.className === \"CartModal__\") {\n      setModal(<CartModal restName={restInfo.name} menuList={cartItem} setMenuList={setCartItem} setModal={setModal} \n            roomList={roomList} /*roomLength={roomInfo.length}*/ roomInfo={roomInfo}\n            roomIdUserJoining={roomIdUserJoining} deliAddr={deliAddr}></CartModal>)\n    }\n      \n  }\n  \n  const [cartItem, setCartItem] \n    = useState([])\n  useEffect(handleCartItemUpdate, [cartItem])\n  \n  function openCartModal() {\n    setModal(<CartModal restName={restInfo.name} menuList={cartItem} setMenuList={setCartItem} setModal={setModal} \n          roomList={roomList} /*roomLength={roomInfo.length}*/ roomInfo={roomInfo}\n          roomIdUserJoining={roomIdUserJoining} deliAddr={deliAddr}></CartModal>)\n  }\n\n  const menuList = menuItemInfo.map((menu) => \n  <li key={menu.id} style={{listStyle:'none'}} className = \"mainPage__menu-item\">\n    <a onClick={() => openMenuModal(menu)}> <MenuListItem menuItemInfo={menu}></MenuListItem></a>\n  </li>\n  )\n\n  const info = \n    <div className = \"restPage__info\">\n      <p className = \"restPage__info-text\">{restInfo.info}</p>\n      <div className = \"restPage__info-opening\">\n        <p>Open at {restInfo.open}</p>\n        <p>Close at {restInfo.close}</p>\n      </div>\n    </div>\n  \n\n  const [roomInfo, setRoomInfo] = useState([]);\n\n  function getRooms() {\n    getDoc(doc(db, \"users\", userId)).then((user) => {\n      setDeliAddr(user.data().addr)\n\n      if (user.data().curRoomId !== \"\") {\n        setRoomIdUserJoining(user.data().curRoomId)\n        getDoc(doc(db, \"rooms\", user.data().curRoomId)).then((room) => {\n          const { restName, addr, ordStat, parti, endTime } = room.data();\n          setRoomInfo([{\n            'roomId': user.data().curRoomId, 'restName': restName,\n            'addr': addr, 'ordStat': ordStat,\n            'parti': parti, 'endTime': endTime,\n            'timeLeft': parseInt((endTime.seconds - new Date().getTime() / 1000) / 60),\n            'rest': restInfo,\n            'poolMon': parti.reduce((money, menu) => money + menu.price, 0) \n          }])\n        })\n      } else {\n        onSnapshot(collection(db, \"rooms\"), (snapshot) => {\n          const tmp = [];\n          snapshot.forEach((doc) => tmp.push({room: doc.data(), room_id: doc.id}))\n          setRoomInfo(tmp.filter((el) => el.room.addr === user.data().addr).map(({room, room_id}) => ({\n            'roomId': room_id, 'restName': room.restName,\n            'addr': room.addr, 'ordStat': room.ordStat,\n            'parti': room.parti, 'endTime': room.endTime,\n            'timeLeft': parseInt((room.endTime.seconds - new Date().getTime() / 1000) / 60),\n            'rest': restInfo,\n            'poolMon': room.parti.reduce((money, menu) => money + menu.price, 0) \n          })));\n        })\n      }\n    })\n  }\n\n  useEffect(() => {\n    getRooms();\n  }, []);\n\n  // for (const room of roomInfo) {\n  //     room['rest'] = restInfo;\n  // }\n\n  const [roomList, setRoomList] = useState(<></>)\n  useEffect(() => {\n\n      setRoomList(roomInfo.filter((room) => room.restName==restInfo.name)\n      .map((room, i) => \n      <li key={i} style={{listStyle:'none'}}>\n          <div> <RoomCard roomInfo={room} photo={true}></RoomCard></div>\n      </li>))\n      if (roomInfo.filter((room) => room.restName==restInfo.name).length === 0) {\n        setRoomList(<p>만들어진 방이 없습니다.</p>)\n      }\n  }, [roomInfo]);\n\n  \n\n  const [curTab, setCurTab] = useState(\"menu\");\n  const curTabContent = {\n    \"menu\": menuList,\n    \"info\": info,\n    \"room\": roomList\n  }\n\n  function goBack() {\n    if (cartItem.length != 0) {\n      if (window.confirm(\"카트가 비워집니다. 뒤로 가시겠습니까?\")) {\n        navigate(-1)\n      }\n    } else {\n      navigate(-1)\n    }\n  }\n\n\n    return (\n        <div className=\"ui-container\">\n          {modal}\n          <div className={classNameRestPage}>\n            {/* <TabBar/> */}\n            \n            <div className=\"rest-title-image\" style={{backgroundImage: `url(${restInfo.photo})`}}>\n              <div className=\"rest-title\">\n                <button className=\"rest-title-back\" onClick={goBack}>\n                    <AiOutlineArrowLeft /> \n                </button>\n                <div></div>\n              </div>\n                \n                <RestTitleBox restName={restInfo.name} restRating=\"5.0 (100)\"></RestTitleBox>   \n            </div>\n            <RestTab curTab = {curTab} setCurTab = {setCurTab}/>\n            <ul className=\"restPage__content-list\">\n              {curTabContent[curTab]}\n            </ul>\n            <CartButton cartItem={cartItem} onClick={openCartModal}/>\n          </div>\n        </div>\n    )\n    }\n\n\nexport default RestaurantPage\n"]},"metadata":{},"sourceType":"module"}