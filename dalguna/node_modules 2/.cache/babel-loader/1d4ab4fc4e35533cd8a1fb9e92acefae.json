{"ast":null,"code":"var _jsxFileName = \"/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/src/pages/Main.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { Link, useParams, useNavigate } from \"react-router-dom\";\nimport { collection, onSnapshot, updateDoc, doc, getDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase-config.js\";\nimport RoomCard from '../components/RoomCard';\nimport CatFilter from './CatFilter';\nimport CatItem from '../components/CatItem';\nimport RestCard from '../components/RestCard.js';\nimport NavBar from '../components/NavBar.js';\nimport TabBar from '../components/TabBar.js';\nimport CartModal from \"../components/CartModal\";\nimport staticDB from \"../db/static.json\";\nimport dhspic from '../img/DHS_photo.jpeg';\nimport \"../main.css\";\n\nfunction Main() {\n  const [deliAddr, setDeliAddr] = useState(\"\");\n  const restInfo = staticDB;\n  const [roomInfo, setRoomInfo] = useState([]);\n  const [isUserParticipants, setIsUserParticipants] = useState(false);\n  const catInfoList = [{\n    name: \"한식\",\n    img: dhspic\n  }, {\n    name: \"일식\",\n    img: dhspic\n  }, {\n    name: \"분식\",\n    img: dhspic\n  }, {\n    name: \"아시아\",\n    img: dhspic\n  }, {\n    name: \"샐러드\",\n    img: dhspic\n  }, {\n    name: \"도시락\",\n    img: dhspic\n  }, {\n    name: \"중국집\",\n    img: dhspic\n  }, {\n    name: \"덮밥\",\n    img: dhspic\n  }];\n\n  const stringToTime = str => {\n    const [hour, minute] = str.split(':').map(el => parseInt(el));\n    return hour * 60 + minute;\n  };\n\n  const restList = restInfo.filter(rest => {\n    const nowTime = new Date().getHours() * 60 + new Date().getMinutes();\n    return stringToTime(rest.open) <= nowTime && nowTime <= stringToTime(rest.close);\n  }).map((rest, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    style: {\n      listStyle: 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: `./restaurant/${rest.id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(RestCard, {\n    restInfo: rest,\n    roomInfo: roomInfo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 43\n    }\n  }))));\n  const catList = catInfoList.map((cat, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    style: {\n      listStyle: 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: {\n      pathname: `./filter/${cat.name}`\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 9\n    }\n  }, \" \", /*#__PURE__*/React.createElement(CatItem, {\n    img: cat.img,\n    name: cat.name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 46\n    }\n  }), \" \")));\n  const [myRoomCard, setMyRoomCard] = useState( /*#__PURE__*/React.createElement(React.Fragment, null));\n  const [otherRoomList, setOtherRoomList] = useState( /*#__PURE__*/React.createElement(React.Fragment, null));\n  const {\n    userId\n  } = useParams();\n  const navigate = useNavigate();\n\n  function getRooms() {\n    onSnapshot(collection(db, \"rooms\"), snapshot => {\n      const tmp = [];\n      snapshot.forEach(doc => tmp.push({\n        room_id: doc.id,\n        room: doc.data()\n      }));\n      setRoomInfo(tmp.map(_ref => {\n        let {\n          room,\n          room_id\n        } = _ref;\n        const roomInfoObj = {\n          'roomId': room_id,\n          'restName': room.restName,\n          'addr': room.addr,\n          'ordStat': room.ordStat,\n          'parti': room.parti,\n          'endTime': room.endTime,\n          'timeLeft': parseInt((room.endTime.seconds - new Date().getTime() / 1000) / 60),\n          'rest': restInfo.filter(rest => rest.name == room.restName)[0],\n          'poolMon': room.parti.reduce((money, menu) => money + menu.price, 0)\n        };\n\n        if (room.parti.filter(el => el.id === userId).length !== 0) {\n          setMyRoomCard( /*#__PURE__*/React.createElement(Link, {\n            to: {\n              pathname: `./${room_id}`\n            },\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 25\n            }\n          }, \" \", /*#__PURE__*/React.createElement(RoomCard, {\n            roomInfo: roomInfoObj,\n            photo: true,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 63\n            }\n          })));\n          setOtherRoomList( /*#__PURE__*/React.createElement(React.Fragment, null));\n          setIsUserParticipants(true);\n        }\n\n        return roomInfoObj;\n      }));\n      updateDoc(doc(db, \"users\", userId), {\n        curRoomId: \"\"\n      });\n    });\n    getDoc(doc(db, \"users\", userId)).then(user => {\n      if (user.data() !== undefined) {\n        const {\n          addr\n        } = user.data();\n\n        if (addr === \"\" || addr === undefined) {\n          setDeliAddr(\"배달장소 선택\");\n        } else {\n          setDeliAddr(addr);\n        }\n      }\n    });\n  }\n\n  useEffect(() => {\n    getRooms();\n  }, []);\n\n  function handleRoomEnter(roomId, restName) {\n    updateDoc(doc(db, \"users\", userId), {\n      curRoomId: roomId\n    });\n    const restId = restInfo.filter(_ref2 => {\n      let {\n        name\n      } = _ref2;\n      return name === restName;\n    })[0].id;\n\n    if (window.confirm(\"먼저 배달음식을 담아주세요\")) {\n      navigate(`./restaurant/${restId}`);\n    }\n\n    console.log(roomId);\n  }\n\n  useEffect(() => {\n    if (isUserParticipants) {} else {\n      console.log(roomInfo);\n      setMyRoomCard( /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mainPage__noYourRoom\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 21\n        }\n      }, \"\\uC544\\uC9C1 \\uCC38\\uC5EC\\uD558\\uC2E0 \\uBC29\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"));\n      setOtherRoomList( /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mainPage__separation\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"mainPage__title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 9\n        }\n      }, \"Room Suggestions\"), /*#__PURE__*/React.createElement(\"ul\", {\n        style: {\n          margin: 0\n        },\n        className: \"mainPage__room-list\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 9\n        }\n      }, roomInfo.filter(el => el.addr === deliAddr).map((room, i) => /*#__PURE__*/React.createElement(\"li\", {\n        key: i,\n        style: {\n          listStyle: 'none'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        onClick: () => handleRoomEnter(room.roomId, room.restName),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 17\n        }\n      }, \" \", /*#__PURE__*/React.createElement(RoomCard, {\n        roomInfo: room,\n        photo: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 83\n        }\n      })))))));\n    }\n  }, [roomInfo, isUserParticipants, deliAddr]);\n  useEffect(() => {\n    if (deliAddr !== \"배달장소 선택\" && deliAddr !== \"\") {\n      updateDoc(doc(db, \"users\", userId), {\n        addr: deliAddr\n      });\n    }\n  }, [deliAddr]); // [Not Solved] 근데 my room 이 생긴 상태의 사람은 suggestion 없애야할듯\n  // for (const room of roomInfo) {\n  //   room['rest'] = restInfo.filter((rest) => rest.name == room.restName)[0];\n  // }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ui-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPage__\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(NavBar, {\n    deliAddr: deliAddr,\n    setDeliAddr: setDeliAddr,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      height: \"105px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPage__title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }\n  }, \"Food Categories\"), /*#__PURE__*/React.createElement(\"ul\", {\n    className: \"mainPage__cat-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }\n  }, catList), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPage__separation\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPage__title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 9\n    }\n  }, \"Your Room\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPage__room-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 9\n    }\n  }, myRoomCard), otherRoomList, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPage__separation\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPage__title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }\n  }, \"Restaurant List\"), /*#__PURE__*/React.createElement(\"ul\", {\n    style: {\n      margin: 0\n    },\n    className: \"mainPage__rest-card-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 9\n    }\n  }, restList)));\n}\n\nexport default Main;","map":{"version":3,"sources":["/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/src/pages/Main.js"],"names":["React","useState","useEffect","Link","useParams","useNavigate","collection","onSnapshot","updateDoc","doc","getDoc","db","RoomCard","CatFilter","CatItem","RestCard","NavBar","TabBar","CartModal","staticDB","dhspic","Main","deliAddr","setDeliAddr","restInfo","roomInfo","setRoomInfo","isUserParticipants","setIsUserParticipants","catInfoList","name","img","stringToTime","str","hour","minute","split","map","el","parseInt","restList","filter","rest","nowTime","Date","getHours","getMinutes","open","close","i","listStyle","id","catList","cat","pathname","myRoomCard","setMyRoomCard","otherRoomList","setOtherRoomList","userId","navigate","getRooms","snapshot","tmp","forEach","push","room_id","room","data","roomInfoObj","restName","addr","ordStat","parti","endTime","seconds","getTime","reduce","money","menu","price","length","curRoomId","then","user","undefined","handleRoomEnter","roomId","restId","window","confirm","console","log","margin","height"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link, useParams, useNavigate } from \"react-router-dom\";\nimport { collection, onSnapshot, updateDoc, doc, getDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase-config.js\";\n\nimport RoomCard from '../components/RoomCard';\nimport CatFilter from './CatFilter';\nimport CatItem from '../components/CatItem';\nimport RestCard from '../components/RestCard.js'\nimport NavBar from '../components/NavBar.js'\nimport TabBar from '../components/TabBar.js'\nimport CartModal from \"../components/CartModal\";\n\nimport staticDB from \"../db/static.json\";\nimport dhspic from '../img/DHS_photo.jpeg';\n\nimport \"../main.css\";\n\nfunction Main() {\n  const [deliAddr, setDeliAddr] = useState(\"\");\n  const restInfo = staticDB;\n  const [roomInfo, setRoomInfo] = useState([]);\n  const [isUserParticipants, setIsUserParticipants] = useState(false);\n  const catInfoList = [\n    {name: \"한식\", img:dhspic}, \n    {name: \"일식\", img:dhspic},\n    {name: \"분식\", img:dhspic},\n    {name: \"아시아\", img:dhspic},\n    {name: \"샐러드\", img:dhspic},\n    {name: \"도시락\", img:dhspic},\n    {name: \"중국집\", img:dhspic},\n    {name: \"덮밥\", img:dhspic},\n  ]\n\n  const stringToTime = (str) => {\n    const [hour, minute] = str.split(':').map((el) => parseInt(el));\n    return hour * 60 + minute;\n  }\n  const restList = restInfo.filter((rest) => {\n    const nowTime = new Date().getHours() * 60 + new Date().getMinutes();\n    return stringToTime(rest.open) <= nowTime && nowTime <= stringToTime(rest.close);\n  }).map((rest, i) => \n  <li key={i} style={{listStyle:'none'}}>\n     <Link to={`./restaurant/${rest.id}`}><RestCard restInfo={rest} roomInfo={roomInfo}></RestCard></Link>\n  </li>)\n\n  const catList = catInfoList.map((cat, i) => \n      <li key={i} style={{listStyle:'none'}}>\n        <Link to={{\n          pathname:`./filter/${cat.name}`}}> <CatItem img={cat.img} name={cat.name}></CatItem> </Link>\n      </li>\n  )\n  \n  const [myRoomCard, setMyRoomCard] = useState(<></>);\n  const [otherRoomList, setOtherRoomList] = useState(<></>);\n  \n  const { userId } = useParams();\n  const navigate = useNavigate();\n\n  function getRooms() {\n    onSnapshot(collection(db, \"rooms\"), (snapshot) => {\n      const tmp = [];\n      snapshot.forEach((doc) => tmp.push({room_id: doc.id, room: doc.data()}))\n      setRoomInfo(tmp.map(({room, room_id}) => {\n        const roomInfoObj = {\n          'roomId': room_id, 'restName': room.restName,\n          'addr': room.addr, 'ordStat': room.ordStat,\n          'parti': room.parti, 'endTime': room.endTime,\n          'timeLeft': parseInt((room.endTime.seconds - new Date().getTime() / 1000) / 60),\n          'rest': restInfo.filter((rest) => rest.name == room.restName)[0],\n          'poolMon': room.parti.reduce((money, menu) => money + menu.price, 0) \n        }\n        if (room.parti.filter((el) => el.id === userId).length !== 0) {\n          setMyRoomCard(<Link to={{pathname:`./${room_id}`}}> <RoomCard roomInfo={roomInfoObj} photo={true}></RoomCard></Link>)\n          setOtherRoomList(<></>)\n          setIsUserParticipants(true);\n        }\n        return roomInfoObj}));\n      updateDoc(doc(db, \"users\", userId), {\n        curRoomId: \"\"\n      })\n    })\n\n    getDoc(doc(db, \"users\", userId)).then((user)=> {\n      if (user.data() !== undefined) {\n        const { addr } = user.data()\n        if (addr === \"\" || addr === undefined) {\n          setDeliAddr(\"배달장소 선택\")\n        } else {\n          setDeliAddr(addr)\n        }\n      }\n    })\n  }\n\n  useEffect(() => {\n    getRooms();\n  }, []);\n\n  function handleRoomEnter(roomId, restName) {\n    updateDoc(doc(db, \"users\", userId), {\n      curRoomId: roomId\n    })\n    const restId = restInfo.filter(({name}) => name === restName)[0].id\n    if (window.confirm(\"먼저 배달음식을 담아주세요\")) {\n      navigate(`./restaurant/${restId}`)\n    }\n    console.log(roomId)\n  }\n\n  useEffect(() => {\n    if (isUserParticipants) {}\n    else {\n      console.log(roomInfo, )\n      setMyRoomCard(<div className=\"mainPage__noYourRoom\">아직 참여하신 방이 없습니다.</div>)\n      setOtherRoomList(<>\n        <div className = \"mainPage__separation\"/>\n        <div className = \"mainPage__title\">Room Suggestions</div>\n        <ul style={{margin:0}} className = \"mainPage__room-list\">\n            {roomInfo.filter((el) => el.addr === deliAddr).map((room, i) => \n            <li key={i} style={{listStyle:'none'}}>\n                <div onClick={() => handleRoomEnter(room.roomId, room.restName)}> <RoomCard roomInfo={room} photo={true}></RoomCard></div>\n            </li>)}\n        </ul></>\n        )\n    }\n\n  }, [roomInfo, isUserParticipants, deliAddr])\n  \n  useEffect(() => {\n    if (deliAddr !== \"배달장소 선택\" && deliAddr !== \"\") {\n      updateDoc(doc(db, \"users\", userId), {\n        addr: deliAddr\n      })\n    }\n  }, [deliAddr])\n  \n  // [Not Solved] 근데 my room 이 생긴 상태의 사람은 suggestion 없애야할듯\n  // for (const room of roomInfo) {\n  //   room['rest'] = restInfo.filter((rest) => rest.name == room.restName)[0];\n  // }\n\n\n  return (\n    <div className=\"ui-container\">\n      <div className=\"mainPage__\">\n        <NavBar deliAddr={deliAddr} setDeliAddr={setDeliAddr}/>\n        <div style={{height:\"105px\"}}/>\n        <div className = \"mainPage__title\">Food Categories</div>\n        <ul className = \"mainPage__cat-list\">\n            {catList}\n        </ul>\n        <div className = \"mainPage__separation\"/>\n        <div className = \"mainPage__title\">Your Room</div>\n        <div className = \"mainPage__room-list\">\n            {myRoomCard}\n        </div>\n        {otherRoomList}\n        <div className = \"mainPage__separation\"/>\n        <div className = \"mainPage__title\">Restaurant List</div>\n        <ul style={{margin:0}} className = \"mainPage__rest-card-list\">\n            {restList}\n        </ul>\n        {/* <TabBar/> */}\n      </div>\n    </div>\n      \n  )\n}\n\nexport default Main;"]},"metadata":{},"sourceType":"module"}