{"ast":null,"code":"import _toConsumableArray from\"/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{CgClose}from'react-icons/cg';import CartMenuItem from\"./CartMenuItem\";import RoomCard from\"./RoomCard\";import LongButton from\"./LongButton\";import{useParams,useNavigate}from\"react-router-dom\";import{collection,onSnapshot,getDoc,updateDoc,doc}from\"firebase/firestore\";import{db}from\"../firebase-config.js\";import NewRoomModal from\"./NewRoomModal\";import\"../cart_modal.css\";function CartModal(props){var params=useParams();var navigate=useNavigate();var restName=props.restName,menuList=props.menuList,setMenuList=props.setMenuList,setModal=props.setModal,roomList=props.roomList,roomInfo=props.roomInfo,roomIdUserJoining=props.roomIdUserJoining,deliAddr=props.deliAddr;var roomLength=roomInfo.length;// const createButtonClassName = { true: \"\" ,\n//         false: \"cartModal__createHide\" }\nvar _useState=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState2=_slicedToArray(_useState,2),createButton=_useState2[0],setCreateButton=_useState2[1];var _useState3=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState4=_slicedToArray(_useState3,2),roomListClickable=_useState4[0],setRoomListClickable=_useState4[1];var _useState5=useState(menuList),_useState6=_slicedToArray(_useState5,2),updatedRealMenuList=_useState6[0],setUpdatedRealMenuList=_useState6[1];// useEffect(()=> {\n//     if (roomIdUserJoining === \"\") {\n//         setCreateButton(<div className=\"CartModal__create-room\">\n//             <span style={{color:\"grey\", fontSize:\"0.9rem\", fontWeight:\"bold\"}}>원하는 방을 찾지 못하셨나요?</span>\n//             <LongButton onClick={openNewRoomModal} type=\"primary\">새로운 방 만들기</LongButton>\n//         </div>)\n//     } else {\n//         setCreateButton(<div className=\"CartModal__create-room\">\n//             <span style={{color:\"grey\", fontSize:\"0.9rem\", fontWeight:\"bold\"}}>선택한 방에서 같이 주문할까요?</span>\n//             <LongButton onClick={() => enterExistingRoom(roomIdUserJoining)} type=\"primary\">모임에 합류하기</LongButton>\n//         </div>)\n//     }\n// }, [roomIdUserJoining])\n// useEffect(updateRoomListClickable, [roomInfo]);\n// function updateRoomListClickable() {\n//     setRoomListClickable(roomInfo.filter((room) => room.restName==restName)\n//     .map((room, i) => \n//     <li key={i} style={{listStyle:'none'}}>\n//         <div onClick={() => enterExistingRoom(room.roomId)}> <RoomCard roomInfo={room} photo={true}></RoomCard></div>\n//     </li>))\n//     if (roomInfo.filter((room) => room.restName==restName).length === 0) {\n//         setRoomListClickable(<p>만들어진 방이 없습니다.</p>)\n//     }\n// }\nvar _useState7=useState(menuList.map(function(menu,i){return/*#__PURE__*/React.createElement(CartMenuItem,{key:i,menuDetail:menu,setMenuDetail:setMenuList,menuList:menuList,menuId:i});})),_useState8=_slicedToArray(_useState7,2),menuVisible=_useState8[0],setMenuVisible=_useState8[1];function goBack(){setModal(/*#__PURE__*/React.createElement(React.Fragment,null));}useEffect(updateCartMenu,[menuList,roomIdUserJoining,roomInfo]);function updateCartMenu(){console.log(params.userId,menuList);var copied=_toConsumableArray(menuList);setMenuVisible(copied.map(function(menu,i){return/*#__PURE__*/React.createElement(CartMenuItem,{key:i,menuDetail:menu,setMenuDetail:setMenuList,menuList:menuList,menuId:i});}));if(menuList.length===0){setCreateButton(/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__create-room\"},/*#__PURE__*/React.createElement(\"span\",{style:{color:\"grey\",fontSize:\"0.9rem\",fontWeight:\"bold\"}},\"\\uCE74\\uD2B8\\uAC00 \\uBE44\\uC5B4\\uC788\\uC2B5\\uB2C8\\uB2E4.\"),/*#__PURE__*/React.createElement(LongButton,{type:\"secondary\"},\"\\uC8FC\\uBB38\\uD558\\uAE30\")));setRoomListClickable(roomInfo.filter(function(room){return room.restName==restName;}).map(function(room,i){return/*#__PURE__*/React.createElement(\"li\",{key:i,style:{listStyle:'none'}},/*#__PURE__*/React.createElement(\"div\",{onClick:function onClick(){return window.alert(\"카트가 비었습니다.\");}},\" \",/*#__PURE__*/React.createElement(RoomCard,{roomInfo:room,photo:true})));}));}else{if(roomIdUserJoining===\"\"){setCreateButton(/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__create-room\"},/*#__PURE__*/React.createElement(\"span\",{style:{color:\"grey\",fontSize:\"0.9rem\",fontWeight:\"bold\"}},\"\\uC6D0\\uD558\\uB294 \\uBC29\\uC744 \\uCC3E\\uC9C0 \\uBABB\\uD558\\uC168\\uB098\\uC694?\"),/*#__PURE__*/React.createElement(LongButton,{onClick:openNewRoomModal,type:\"primary\"},\"\\uC0C8\\uB85C\\uC6B4 \\uBC29 \\uB9CC\\uB4E4\\uAE30\")));}else{setCreateButton(/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__create-room\"},/*#__PURE__*/React.createElement(\"span\",{style:{color:\"grey\",fontSize:\"0.9rem\",fontWeight:\"bold\"}},\"\\uC120\\uD0DD\\uD55C \\uBC29\\uC5D0\\uC11C \\uAC19\\uC774 \\uC8FC\\uBB38\\uD560\\uAE4C\\uC694?\"),/*#__PURE__*/React.createElement(LongButton,{onClick:function onClick(){return enterExistingRoom(roomIdUserJoining);},type:\"primary\"},\"\\uBAA8\\uC784\\uC5D0 \\uD569\\uB958\\uD558\\uAE30\")));}console.log(roomInfo);setRoomListClickable(roomInfo.filter(function(room){return room.restName==restName;}).map(function(room,i){return/*#__PURE__*/React.createElement(\"li\",{key:i,style:{listStyle:'none'}},/*#__PURE__*/React.createElement(\"div\",{onClick:function onClick(){return enterExistingRoom(room.roomId);}},\" \",/*#__PURE__*/React.createElement(RoomCard,{roomInfo:room,photo:true})));}));}if(roomInfo.filter(function(room){return room.restName==restName;}).length===0){setRoomListClickable(/*#__PURE__*/React.createElement(\"p\",null,\"\\uB9CC\\uB4E4\\uC5B4\\uC9C4 \\uBC29\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"));}}var _useState9=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState10=_slicedToArray(_useState9,2),newRoomModal=_useState10[0],setNewRoomModal=_useState10[1];function openNewRoomModal(){console.log(menuList);setNewRoomModal(/*#__PURE__*/React.createElement(\"div\",{className:\"new-modal-container\",onClick:closeNewRoomModal},/*#__PURE__*/React.createElement(NewRoomModal,{restName:restName,menuList:menuList,deliAddr:deliAddr})));}var closeNewRoomModal=function closeNewRoomModal(e){var contactHeight=e.clientY;var windowHeight=window.innerHeight;if(windowHeight-contactHeight>255){setNewRoomModal(/*#__PURE__*/React.createElement(React.Fragment,null));}};function enterExistingRoom(roomId){if(window.confirm(\"주문할까요?\")){if(menuList.length===0){window.alert(\"카트가 비어있습니다.\");}else{getDoc(doc(db,\"rooms\",roomId)).then(function(room){var _room$data=room.data(),parti=_room$data.parti;var updatedParti=[].concat(_toConsumableArray(parti),[{\"id\":params.userId,\"menu\":menuList,\"ordNow\":false,\"price\":menuList.reduce(function(price,menu){return price+menu.price*menu.qnty;},0)}]);updateDoc(doc(db,\"rooms\",roomId),{parti:updatedParti});navigate(\"../\".concat(params.userId));});}}}return/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__\",style:{backgroundColor:\"white\",height:\"100%\"}},/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__bar\"},/*#__PURE__*/React.createElement(\"button\",{onClick:goBack,className:\"CartModal__bar-close\"},/*#__PURE__*/React.createElement(CgClose,null)),/*#__PURE__*/React.createElement(\"span\",{className:\"CartModal__bar-cart\"},\"Cart\")),/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__address\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"span\",null,\"Delivery to \"),/*#__PURE__*/React.createElement(\"span\",{style:{fontWeight:\"bold\"}},deliAddr)),/*#__PURE__*/React.createElement(\"a\",{href:\"#\",className:\"CartModal__address-edit\"},\"Edit\")),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__restmenu\"},/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__title\"},restName),menuVisible,/*#__PURE__*/React.createElement(\"button\",{className:\"CartModal__restmenu-add\",onClick:goBack},\"+ Add More Menu\")),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__room\"},/*#__PURE__*/React.createElement(\"div\",{className:\"CartModal__title\"},\"Rooms Available\"),/*#__PURE__*/React.createElement(\"ul\",{style:{padding:0},className:\"CartModal__room-list\"},roomLength!==0?roomListClickable:/*#__PURE__*/React.createElement(\"p\",{style:{color:\"grey\"}},\" \\uD604\\uC7AC \\uAC00\\uB2A5\\uD55C \\uBC29\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4. \"))),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),createButton,newRoomModal);}export default CartModal;","map":{"version":3,"sources":["/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/src/components/CartModal.js"],"names":["React","useState","useEffect","CgClose","CartMenuItem","RoomCard","LongButton","useParams","useNavigate","collection","onSnapshot","getDoc","updateDoc","doc","db","NewRoomModal","CartModal","props","params","navigate","restName","menuList","setMenuList","setModal","roomList","roomInfo","roomIdUserJoining","deliAddr","roomLength","length","createButton","setCreateButton","roomListClickable","setRoomListClickable","updatedRealMenuList","setUpdatedRealMenuList","map","menu","i","menuVisible","setMenuVisible","goBack","updateCartMenu","console","log","userId","copied","color","fontSize","fontWeight","filter","room","listStyle","window","alert","openNewRoomModal","enterExistingRoom","roomId","newRoomModal","setNewRoomModal","closeNewRoomModal","e","contactHeight","clientY","windowHeight","innerHeight","confirm","then","data","parti","updatedParti","reduce","price","qnty","backgroundColor","height","padding"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\"\nimport { CgClose } from 'react-icons/cg';\nimport CartMenuItem from \"./CartMenuItem\";\nimport RoomCard from \"./RoomCard\";\nimport LongButton from \"./LongButton\";\n\nimport { useParams, useNavigate } from \"react-router-dom\";\n\nimport { collection, onSnapshot, getDoc, updateDoc, doc } from \"firebase/firestore\";\nimport { db } from \"../firebase-config.js\";\n\nimport NewRoomModal from \"./NewRoomModal\"\n\nimport \"../cart_modal.css\"\n\nfunction CartModal(props) {\n    const params = useParams()\n    const navigate = useNavigate()\n    \n    const { restName, menuList, setMenuList, setModal, roomList, roomInfo, roomIdUserJoining, deliAddr } = props\n    const roomLength = roomInfo.length\n    \n    // const createButtonClassName = { true: \"\" ,\n    //         false: \"cartModal__createHide\" }\n\n    const [createButton, setCreateButton] = useState(<></>)\n\n    const [roomListClickable, setRoomListClickable] = useState(<></>)\n\n    const [updatedRealMenuList, setUpdatedRealMenuList] = useState(menuList)\n\n    // useEffect(()=> {\n    //     if (roomIdUserJoining === \"\") {\n    //         setCreateButton(<div className=\"CartModal__create-room\">\n    //             <span style={{color:\"grey\", fontSize:\"0.9rem\", fontWeight:\"bold\"}}>원하는 방을 찾지 못하셨나요?</span>\n    //             <LongButton onClick={openNewRoomModal} type=\"primary\">새로운 방 만들기</LongButton>\n    //         </div>)\n    //     } else {\n    //         setCreateButton(<div className=\"CartModal__create-room\">\n    //             <span style={{color:\"grey\", fontSize:\"0.9rem\", fontWeight:\"bold\"}}>선택한 방에서 같이 주문할까요?</span>\n    //             <LongButton onClick={() => enterExistingRoom(roomIdUserJoining)} type=\"primary\">모임에 합류하기</LongButton>\n    //         </div>)\n    //     }\n\n    // }, [roomIdUserJoining])\n\n    // useEffect(updateRoomListClickable, [roomInfo]);\n    // function updateRoomListClickable() {\n    //     setRoomListClickable(roomInfo.filter((room) => room.restName==restName)\n    //     .map((room, i) => \n    //     <li key={i} style={{listStyle:'none'}}>\n    //         <div onClick={() => enterExistingRoom(room.roomId)}> <RoomCard roomInfo={room} photo={true}></RoomCard></div>\n    //     </li>))\n\n    //     if (roomInfo.filter((room) => room.restName==restName).length === 0) {\n    //         setRoomListClickable(<p>만들어진 방이 없습니다.</p>)\n    //     }\n    // }\n    \n\n    const [menuVisible, setMenuVisible] \n        = useState(menuList.map((menu, i) => \n            <CartMenuItem key={i} menuDetail={menu} setMenuDetail={setMenuList} menuList={menuList} menuId={i}/>))\n    \n    function goBack() {\n        setModal(<></>)\n    }\n\n    useEffect(updateCartMenu, [menuList, roomIdUserJoining, roomInfo]) \n    \n    function updateCartMenu() {\n        console.log(params.userId, menuList)\n        var copied = [...menuList]\n           \n        setMenuVisible(copied.map((menu, i) =>\n                <CartMenuItem key={i} menuDetail={menu} setMenuDetail={setMenuList} menuList={menuList} menuId={i}/>))\n        \n        if (menuList.length === 0) {\n            setCreateButton(<div className=\"CartModal__create-room\">\n                <span style={{color:\"grey\", fontSize:\"0.9rem\", fontWeight:\"bold\"}}>카트가 비어있습니다.</span>\n                <LongButton type=\"secondary\">주문하기</LongButton>\n            </div>)\n\n            setRoomListClickable(roomInfo.filter((room) => room.restName==restName)\n                .map((room, i) => \n                <li key={i} style={{listStyle:'none'}}>\n                    <div onClick={() => window.alert(\"카트가 비었습니다.\")}> <RoomCard roomInfo={room} photo={true}></RoomCard></div>\n                </li>))\n        } else {\n            if (roomIdUserJoining === \"\") {\n                setCreateButton(<div className=\"CartModal__create-room\">\n                    <span style={{color:\"grey\", fontSize:\"0.9rem\", fontWeight:\"bold\"}}>원하는 방을 찾지 못하셨나요?</span>\n                    <LongButton onClick={openNewRoomModal} type=\"primary\">새로운 방 만들기</LongButton>\n                </div>)\n            } else {\n                setCreateButton(<div className=\"CartModal__create-room\">\n                    <span style={{color:\"grey\", fontSize:\"0.9rem\", fontWeight:\"bold\"}}>선택한 방에서 같이 주문할까요?</span>\n                    <LongButton onClick={() => enterExistingRoom(roomIdUserJoining)} type=\"primary\">모임에 합류하기</LongButton>\n                </div>)\n            }\n            console.log(roomInfo)\n            setRoomListClickable(roomInfo.filter((room) => room.restName==restName)\n                .map((room, i) => \n                    <li key={i} style={{listStyle:'none'}}>\n                        <div onClick={() => enterExistingRoom(room.roomId)}> <RoomCard roomInfo={room} photo={true}></RoomCard></div>\n                    </li>))\n        }\n        if (roomInfo.filter((room) => room.restName==restName).length === 0) {\n            setRoomListClickable(<p>만들어진 방이 없습니다.</p>)\n        }\n    }\n\n    const [newRoomModal, setNewRoomModal] = useState(<></>)\n\n    function openNewRoomModal() {\n        console.log(menuList)\n        setNewRoomModal(<div className=\"new-modal-container\" onClick={closeNewRoomModal}><NewRoomModal restName={restName} menuList={menuList} deliAddr={deliAddr}/></div>)\n    }\n\n    const closeNewRoomModal = (e) => {\n        var contactHeight = e.clientY;\n        var windowHeight = window.innerHeight;\n        if (windowHeight - contactHeight > 255) {\n            setNewRoomModal(<></>)\n        }\n    }\n\n    function enterExistingRoom(roomId) {\n        if (window.confirm(\"주문할까요?\") ) {\n            if (menuList.length === 0) {\n                window.alert(\"카트가 비어있습니다.\")\n            } else {\n                getDoc(doc(db, \"rooms\", roomId)).then((room) => {\n                    const { parti } = room.data();\n                    const updatedParti = [...parti, {\n                        \"id\": params.userId,\n                        \"menu\": menuList, \n                        \"ordNow\": false,\n                        \"price\": menuList.reduce((price, menu) => price + menu.price * menu.qnty, 0)\n                    }]\n                    updateDoc(doc(db, \"rooms\", roomId), {\n                        parti: updatedParti,\n                    })\n                    navigate(`../${params.userId}`)\n                }\n                )\n            }\n        }\n    } \n\n\n    return (\n        <div className=\"CartModal__\" style={{backgroundColor:\"white\", height:\"100%\"}}>\n            <div className=\"CartModal__bar\">\n                <button onClick={goBack} className=\"CartModal__bar-close\"><CgClose></CgClose></button>\n                <span className=\"CartModal__bar-cart\">Cart</span>\n            </div>\n            <div className=\"CartModal__address\">\n                <div><span>Delivery to </span><span style={{fontWeight:\"bold\"}}>{deliAddr}</span></div>\n                <a href=\"#\" className=\"CartModal__address-edit\">Edit</a>\n            </div>\n            <div className = \"mainPage__separation\"/>\n            <div className=\"CartModal__restmenu\">\n                <div className=\"CartModal__title\">{restName}</div>\n                { menuVisible }\n                <button className=\"CartModal__restmenu-add\" onClick={goBack}>+ Add More Menu</button>\n            </div>\n            <div className = \"mainPage__separation\"/>\n            {/* <div className=\"CartModal__request\">\n            </div>\n            <div className = \"mainPage__separation\"/> */}\n            <div className =\"CartModal__room\">\n                <div className=\"CartModal__title\">\n                    Rooms Available\n                </div>\n                <ul style={{padding:0}} className = \"CartModal__room-list\">\n                    {roomLength !== 0 ? roomListClickable : <p style={{color:\"grey\"}}> 현재 가능한 방이 없습니다. </p> }\n                </ul>\n            </div>\n            <div className = \"mainPage__separation\"/>\n            {createButton}\n            {newRoomModal}\n        </div>\n    )\n}\n\nexport default CartModal;"]},"metadata":{},"sourceType":"module"}