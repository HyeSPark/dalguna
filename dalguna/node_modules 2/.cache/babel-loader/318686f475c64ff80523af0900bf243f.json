{"ast":null,"code":"import _toConsumableArray from\"/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import RoomCard from\"../components/RoomCard\";import LongButton from\"../components/LongButton\";import staticDB from\"../db/static.json\";import{useParams,useNavigate}from\"react-router-dom\";import{collection,onSnapshot,doc,updateDoc}from\"firebase/firestore\";import{db}from\"../firebase-config.js\";import'../checkout.css';import{AiOutlineArrowLeft}from'react-icons/ai';function CheckOut(){// const [roomInfo, setRoomInfo] = useState([{\n//     name: \"잇마이타이\",\n//     timeLeft: 10,\n//     loc: \"아름관\",\n//     deliTime: \"11~20\",\n//     raised: 23000,\n//     minOrd: 20000,\n//   }])\nvar navigate=useNavigate();var _useParams=useParams(),userId=_useParams.userId,roomId=_useParams.roomId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),menuItemInfo=_useState2[0],setMenuItemInfo=_useState2[1];// arr\nvar _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),roomInfo=_useState4[0],setRoomInfo=_useState4[1];// obj from the docID\nvar _useState5=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState6=_slicedToArray(_useState5,2),checkOutList=_useState6[0],setCheckOutList=_useState6[1];//   const [restInfo, setRestInfo] = useState(); // obj from the static db\nvar _useState7=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState8=_slicedToArray(_useState7,2),roomCard=_useState8[0],setRoomCard=_useState8[1];var _useState9=useState({time:\"0~0\",addr:\" \",expDeliTime:\" \",deliFee:0,orgFee:\"\"}),_useState10=_slicedToArray(_useState9,2),deliInfo=_useState10[0],setDeliInfo=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),totPrice=_useState12[0],setTotPrice=_useState12[1];var _useState13=useState(/*#__PURE__*/React.createElement(LongButton,{type:\"secondary\"},\"\\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uACE0 \\uC2F6\\uC5B4\\uC694!\")),_useState14=_slicedToArray(_useState13,2),orderNowButton=_useState14[0],setOrderNowButton=_useState14[1];var _useState15=useState(/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_orderNow-explain\"},\"\\uCD5C\\uC18C \\uC8FC\\uBB38\\uAE08\\uC561\\uC744 \\uC544\\uC9C1 \\uB118\\uC9C0 \\uBABB\\uD588\\uC5B4\\uC694\"),orderNowButton)),_useState16=_slicedToArray(_useState15,2),orderNow=_useState16[0],setOrderNow=_useState16[1];function getRooms(){onSnapshot(collection(db,\"rooms\"),function(snapshot){var tmp=[];snapshot.forEach(function(doc){if(doc.id===roomId){tmp.push(doc.data());}});var roomInfoObj=tmp.map(function(room){return{'restName':room.restName,'addr':room.addr,'ordStat':room.ordStat,'parti':room.parti,'endTime':room.endTime,'poolMon':room.parti.reduce(function(money,menu){return money+menu.price;},0),'timeLeft':parseInt((room.endTime.seconds-new Date().getTime()/1000)/60)};})[0];roomInfoObj['rest']=staticDB.filter(function(el){return String(el.name)===String(roomInfoObj.restName);})[0];setRoomInfo(roomInfoObj);console.log(roomInfoObj);setRoomCard(/*#__PURE__*/React.createElement(\"div\",{className:\"checkOut__roomCard\"},/*#__PURE__*/React.createElement(RoomCard,{roomInfo:roomInfoObj,photo:false})));setMenuItemInfo(roomInfoObj.parti.filter(function(el){return String(el.id)===String(userId);})[0].menu);var timeNow=new Date();var timeDeli=new Date();timeDeli.setMinutes(timeNow.getMinutes()+Number(roomInfoObj['rest'].deliInfo.time.split('~')[0]));setDeliInfo({time:roomInfoObj['rest'].deliInfo.time,addr:roomInfoObj.addr,expDeliTime:\"\".concat(timeDeli.getHours(),\":\").concat(timeDeli.getMinutes()),deliFee:roomInfoObj['rest'].deliInfo.fee/roomInfoObj.parti.length,orgFee:roomInfoObj.parti.length!==1?\"\".concat(roomInfoObj['rest'].deliInfo.fee):\"\"});});}useEffect(function(){getRooms();},[]);useEffect(function(){if(roomInfo['parti']!==undefined){var poolMon=roomInfo.parti.reduce(function(prev,curr){return prev+curr.price;},0);if(roomInfo['rest'].deliInfo.minOrder<poolMon){var numOrdNowPeople=roomInfo.parti.filter(function(el){return el.ordNow;}).length;if(roomInfo['parti'].filter(function(el){return String(el.id)===String(userId);})[0].ordNow){setOrderNow(/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_orderNow-explain\"},roomInfo.parti.length,\"\\uBA85 \\uC911 \",numOrdNowPeople,\"\\uBA85\\uC758 \\uC0AC\\uB78C\\uC774 \\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uACE0 \\uC2F6\\uC5B4\\uD574\\uC694\"),/*#__PURE__*/React.createElement(LongButton,{type:\"secondary\"},\"\\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uACE0 \\uC2F6\\uC5B4\\uC694!\"),/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_orderNow-explain\"},\"\\uBC84\\uD2BC\\uC744 \\uC774\\uBBF8 \\uB20C\\uB800\\uC5B4\\uC694\")));}else{setOrderNowButton(/*#__PURE__*/React.createElement(LongButton,{onClick:plzOrderNow,type:\"primary\"},\"\\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uACE0 \\uC2F6\\uC5B4\\uC694!\"));setOrderNow(/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_orderNow-explain\"},roomInfo.parti.length,\"\\uBA85 \\uC911 \",numOrdNowPeople,\"\\uBA85\\uC758 \\uC0AC\\uB78C\\uC774 \\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uACE0 \\uC2F6\\uC5B4\\uD574\\uC694\"),orderNowButton));}}}},[roomInfo,totPrice]);useEffect(function(){setCheckOutList(menuItemInfo.map(function(menu,i){return/*#__PURE__*/React.createElement(\"li\",{key:i,style:{listStyle:'none'},className:\"checkout_list_block\"},/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_menu_name\"},menu.name,\" x \",menu.qnty),/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_menu_price\"},new Intl.NumberFormat('ko-KR',{style:'currency',currency:'KRW'}).format(menu.price*menu.qnty)));}));var totalPrice=_toConsumableArray(menuItemInfo).reduce(function(prev,curr){console.log(curr.price);return prev+curr.price*curr.qnty;},deliInfo.deliFee);setTotPrice(totalPrice);},[menuItemInfo,deliInfo]);//   const room = roomInfo.map((room) =>\n//       <a href=\"#\"> <RoomCard roomInfo={room}></RoomCard></a>)\nfunction plzOrderNow(){console.log(userId);var numOrdNowPeople=roomInfo.parti.filter(function(el){return el.ordNow;}).length;roomInfo.parti.filter(function(el){return el.id==userId;})[0].ordNow=true;console.log(roomInfo);updateDoc(doc(db,'rooms',roomId),{restName:roomInfo.restName,ordStat:roomInfo.ordStat,endTime:roomInfo.endTime,addr:roomInfo.addr,parti:roomInfo.parti});setOrderNow(/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_orderNow-explain\"},roomInfo.parti.length,\"\\uBA85 \\uC911 \",numOrdNowPeople+1,\"\\uBA85\\uC758 \\uC0AC\\uB78C\\uC774 \\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uACE0 \\uC2F6\\uC5B4\\uD574\\uC694\"),/*#__PURE__*/React.createElement(LongButton,{type:\"secondary\"},\"\\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uACE0 \\uC2F6\\uC5B4\\uC694!\"),/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_orderNow-explain\"},\"\\uBC84\\uD2BC\\uC744 \\uC774\\uBBF8 \\uB20C\\uB800\\uC5B4\\uC694\")));}return/*#__PURE__*/React.createElement(\"div\",{className:\"ui-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"checkout_title__\"},/*#__PURE__*/React.createElement(\"div\",{className:\"checkout_title__goBack\",onClick:function onClick(){return navigate(-1);}},/*#__PURE__*/React.createElement(AiOutlineArrowLeft,null)),\"Your Room\"),roomCard,/*#__PURE__*/React.createElement(\"div\",{className:\"checkout_info_block\"},/*#__PURE__*/React.createElement(\"div\",{className:\"checkout_info\"},/*#__PURE__*/React.createElement(\"div\",{className:\"checkout_info-eta\"},/*#__PURE__*/React.createElement(\"span\",{className:\"estimated_time_arrival checkout_info_heading\"},\"\\uC9C0\\uAE08 \\uC2DC\\uD0A4\\uBA74 \",deliInfo.expDeliTime,\" \\uB3C4\\uCC29 \\uC608\\uC815\"),/*#__PURE__*/React.createElement(\"span\",{className:\"estimated_time_arrival checkout_info_content\"},\"\\uBC30\\uB2EC\\uC2DC\\uAC04: \",deliInfo.time,\" \\uBD84\"))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"checkout_info-location\"},/*#__PURE__*/React.createElement(\"span\",{className:\"pickup_location checkout_info_heading\"},\"Pick up Address\"),/*#__PURE__*/React.createElement(\"span\",{className:\"pickup_location checkout_info_content\"},deliInfo.addr))),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_info_content\",style:{textAlign:\"start\",marginTop:\"10px\"}},\"\\uC8FC\\uBB38\\uB0B4\\uC5ED\"),/*#__PURE__*/React.createElement(\"ul\",{className:\"checkOut__orderList\"},checkOutList,/*#__PURE__*/React.createElement(\"li\",{className:\"checkOut__deliFee\"},/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_menu_name\"},\"\\uBC30\\uB2EC\\uBE44\"),/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_menu_price\"},/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_menu_orgPrice\"},deliInfo.orgFee),/*#__PURE__*/React.createElement(\"span\",{style:{color:\"rgba(0, 0, 0, 0.2)\"}},\"\\u27A1 \"),new Intl.NumberFormat('ko-KR',{style:'currency',currency:'KRW'}).format(deliInfo.deliFee),\" \")),/*#__PURE__*/React.createElement(\"li\",{className:\"checkout_list_block\"},/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_menu_name\",style:{fontWeight:\"bold\"}},\"\\uC804\\uCCB4\"),/*#__PURE__*/React.createElement(\"span\",{className:\"checkout_menu_price\",style:{fontWeight:\"bold\"}},new Intl.NumberFormat('ko-KR',{style:'currency',currency:'KRW'}).format(totPrice)))),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"checkout_orderNow\"},orderNow));}export default CheckOut;","map":{"version":3,"sources":["/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/src/pages/CheckOut.js"],"names":["React","useState","useEffect","RoomCard","LongButton","staticDB","useParams","useNavigate","collection","onSnapshot","doc","updateDoc","db","AiOutlineArrowLeft","CheckOut","navigate","userId","roomId","menuItemInfo","setMenuItemInfo","roomInfo","setRoomInfo","checkOutList","setCheckOutList","roomCard","setRoomCard","time","addr","expDeliTime","deliFee","orgFee","deliInfo","setDeliInfo","totPrice","setTotPrice","orderNowButton","setOrderNowButton","orderNow","setOrderNow","getRooms","snapshot","tmp","forEach","id","push","data","roomInfoObj","map","room","restName","ordStat","parti","endTime","reduce","money","menu","price","parseInt","seconds","Date","getTime","filter","el","String","name","console","log","timeNow","timeDeli","setMinutes","getMinutes","Number","split","getHours","fee","length","undefined","poolMon","prev","curr","minOrder","numOrdNowPeople","ordNow","plzOrderNow","i","listStyle","qnty","Intl","NumberFormat","style","currency","format","totalPrice","textAlign","marginTop","color","fontWeight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport RoomCard from \"../components/RoomCard\";\nimport LongButton from \"../components/LongButton\";\n\nimport staticDB from \"../db/static.json\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { collection, onSnapshot, doc, updateDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase-config.js\";\n\nimport '../checkout.css'\nimport { AiOutlineArrowLeft } from 'react-icons/ai';\n\nfunction CheckOut() {\n\n    // const [roomInfo, setRoomInfo] = useState([{\n    //     name: \"잇마이타이\",\n    //     timeLeft: 10,\n    //     loc: \"아름관\",\n    //     deliTime: \"11~20\",\n    //     raised: 23000,\n    //     minOrd: 20000,\n    //   }])\n    const navigate = useNavigate();\n  const { userId, roomId } = useParams()\n\n  const [menuItemInfo, setMenuItemInfo] = useState([]) // arr\n\n  const [roomInfo, setRoomInfo] = useState({}); // obj from the docID\n\n  const [checkOutList, setCheckOutList] = useState(<></>)\n\n//   const [restInfo, setRestInfo] = useState(); // obj from the static db\n\n  const [roomCard, setRoomCard] = useState(<></>)\n\n  const [deliInfo, setDeliInfo] = useState({time:\"0~0\", addr:\" \" , expDeliTime:\" \", deliFee:0, orgFee:\"\"})\n\n  const [totPrice, setTotPrice] = useState(0);\n\n  const [orderNowButton, setOrderNowButton] = useState(<LongButton type=\"secondary\">지금 시키고 싶어요!</LongButton>)\n\n  const [orderNow, setOrderNow] = useState(<><span className = \"checkout_orderNow-explain\">최소 주문금액을 아직 넘지 못했어요</span>\n  {orderNowButton}</>)\n\n\n  function getRooms() {\n\n    onSnapshot(collection(db, \"rooms\"), (snapshot) => {\n      const tmp = [];\n      snapshot.forEach((doc) => {\n          if (doc.id === roomId) {\n            tmp.push(doc.data())\n          }\n      })\n\n      const roomInfoObj = tmp.map((room) => ({\n        'restName': room.restName,\n        'addr': room.addr, 'ordStat': room.ordStat,\n        'parti': room.parti, 'endTime': room.endTime,\n        'poolMon': room.parti.reduce((money, menu) => money + menu.price, 0),\n        'timeLeft': parseInt((room.endTime.seconds - new Date().getTime() / 1000) / 60)\n      }))[0]\n\n      roomInfoObj['rest'] = staticDB.filter((el) => String(el.name) === String(roomInfoObj.restName))[0];\n\n      setRoomInfo(roomInfoObj);\n      console.log(roomInfoObj)\n\n      setRoomCard(<div className=\"checkOut__roomCard\">\n            <RoomCard roomInfo={roomInfoObj} photo={false}></RoomCard>\n        </div>)\n      setMenuItemInfo(roomInfoObj.parti.filter((el) => String(el.id) === String(userId))[0].menu)\n      \n      const timeNow = new Date()\n      var timeDeli = new Date() \n      timeDeli.setMinutes(timeNow.getMinutes() + Number(roomInfoObj['rest'].deliInfo.time.split('~')[0]))\n      setDeliInfo({\n          time: roomInfoObj['rest'].deliInfo.time,\n          addr: roomInfoObj.addr,\n          expDeliTime: `${timeDeli.getHours()}:${timeDeli.getMinutes()}`,\n          deliFee: roomInfoObj['rest'].deliInfo.fee / roomInfoObj.parti.length,\n          orgFee: roomInfoObj.parti.length !== 1 ? `${roomInfoObj['rest'].deliInfo.fee}` : \"\",\n        })\n      \n    })\n  }\n\n  useEffect(() => {\n    getRooms();\n  }, []);\n\n\n  useEffect(() => {\n      if (roomInfo['parti'] !== undefined) {\n          const poolMon = roomInfo.parti.reduce((prev, curr) => prev + curr.price, 0)\n          \n          if (roomInfo['rest'].deliInfo.minOrder < poolMon) {\n            const numOrdNowPeople = roomInfo.parti.filter((el) => el.ordNow).length\n            if (roomInfo['parti'].filter((el) => String(el.id) === String(userId))[0].ordNow) {\n                setOrderNow(<><span className = \"checkout_orderNow-explain\">{roomInfo.parti.length}명 중 {numOrdNowPeople}명의 사람이 지금 시키고 싶어해요</span>\n                <LongButton type=\"secondary\">지금 시키고 싶어요!</LongButton>\n                <span className = \"checkout_orderNow-explain\">버튼을 이미 눌렀어요</span></>)\n            } else {\n                setOrderNowButton(<LongButton onClick={plzOrderNow} type=\"primary\">지금 시키고 싶어요!</LongButton>)\n                setOrderNow(<><span className = \"checkout_orderNow-explain\">{roomInfo.parti.length}명 중 {numOrdNowPeople}명의 사람이 지금 시키고 싶어해요</span>\n                {orderNowButton}</>)\n            }\n          }\n      }\n    \n  }, [roomInfo, totPrice])\n  \n  useEffect(() => {\n      setCheckOutList(menuItemInfo.map((menu, i) => \n            <li key={i} style={{listStyle:'none'}} className = \"checkout_list_block\">\n                <span className=\"checkout_menu_name\">{menu.name} x {menu.qnty}</span>\n                <span className=\"checkout_menu_price\">{new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' })\n                            .format(menu.price * menu.qnty)}</span>\n            </li>))\n\n    const totalPrice = [...menuItemInfo].reduce((prev, curr) => {\n        console.log(curr.price)\n        return(prev + curr.price * curr.qnty)\n     } , deliInfo.deliFee)\n    setTotPrice(totalPrice)\n  }, [menuItemInfo, deliInfo])\n    //   const room = roomInfo.map((room) =>\n    //       <a href=\"#\"> <RoomCard roomInfo={room}></RoomCard></a>)\n    \n\n  function plzOrderNow() {\n      console.log(userId)\n      const numOrdNowPeople = roomInfo.parti.filter((el) => el.ordNow).length\n      roomInfo.parti.filter((el) => el.id == userId)[0].ordNow = true;\n      console.log(roomInfo)\n      updateDoc(doc(db, 'rooms', roomId), {\n          restName: roomInfo.restName, ordStat: roomInfo.ordStat,\n          endTime: roomInfo.endTime, addr: roomInfo.addr,\n          parti: roomInfo.parti\n      });\n      setOrderNow(<><span className = \"checkout_orderNow-explain\">{roomInfo.parti.length}명 중 {numOrdNowPeople + 1}명의 사람이 지금 시키고 싶어해요</span>\n            <LongButton type=\"secondary\">지금 시키고 싶어요!</LongButton>\n            <span className = \"checkout_orderNow-explain\">버튼을 이미 눌렀어요</span></>)\n  }\n    return (\n        <div className=\"ui-container\">\n            <div className =\"checkout_title__\">\n                <div className=\"checkout_title__goBack\" onClick={() => navigate(-1)}><AiOutlineArrowLeft/></div>\n                Your Room\n            </div>\n            {roomCard}\n            <div className=\"checkout_info_block\">\n                <div className=\"checkout_info\">\n                    <div className=\"checkout_info-eta\">\n                        <span className=\"estimated_time_arrival checkout_info_heading\">지금 시키면 {deliInfo.expDeliTime} 도착 예정</span>\n                        <span className=\"estimated_time_arrival checkout_info_content\">배달시간: {deliInfo.time} 분</span>\n                    </div>\n                </div>\n                <br/>\n                <div className=\"checkout_info-location\">\n                    <span className=\"pickup_location checkout_info_heading\">Pick up Address</span>\n                    <span className=\"pickup_location checkout_info_content\">{deliInfo.addr}</span>\n                </div>\n            </div>\n\n            <div className = \"mainPage__separation\"/>\n            <span className=\"checkout_info_content\" style={{textAlign:\"start\", marginTop:\"10px\"}}>주문내역</span>\n            <ul className=\"checkOut__orderList\">\n                {checkOutList}\n                <li className=\"checkOut__deliFee\">\n                    <span className=\"checkout_menu_name\">배달비</span>\n                    <span className=\"checkout_menu_price\">\n                        <span className=\"checkout_menu_orgPrice\">{deliInfo.orgFee}</span> \n                        <span style={{color:\"rgba(0, 0, 0, 0.2)\"}}>➡ </span> \n                        {new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' })\n                            .format(deliInfo.deliFee)} </span>\n                </li>\n                <li className = \"checkout_list_block\">\n                    <span className=\"checkout_menu_name\" style={{fontWeight:\"bold\"}}>전체</span>\n                    <span className=\"checkout_menu_price\" style={{fontWeight:\"bold\"}}>{new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' })\n                            .format(totPrice)}</span>\n                </li>\n            </ul>\n            <div className = \"mainPage__separation\"/>\n            <div className = \"checkout_orderNow\">\n                {orderNow}\n            </div>\n        </div>\n    )\n}\n\nexport default CheckOut\n"]},"metadata":{},"sourceType":"module"}