{"ast":null,"code":"import _slicedToArray from\"/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Link,useParams,useNavigate}from\"react-router-dom\";import{collection,onSnapshot,updateDoc,doc,getDoc}from\"firebase/firestore\";import{db}from\"../firebase-config.js\";import RoomCard from'../components/RoomCard';import CatFilter from'./CatFilter';import CatItem from'../components/CatItem';import RestCard from'../components/RestCard.js';import NavBar from'../components/NavBar.js';import TabBar from'../components/TabBar.js';import CartModal from\"../components/CartModal\";import staticDB from\"../db/static.json\";import dhspic from'../img/DHS_photo.jpeg';import\"../main.css\";function Main(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),deliAddr=_useState2[0],setDeliAddr=_useState2[1];var restInfo=staticDB;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),roomInfo=_useState4[0],setRoomInfo=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isUserParticipants=_useState6[0],setIsUserParticipants=_useState6[1];var catInfoList=[{name:\"한식\",img:dhspic},{name:\"일식\",img:dhspic},{name:\"분식\",img:dhspic},{name:\"아시아\",img:dhspic},{name:\"샐러드\",img:dhspic},{name:\"도시락\",img:dhspic},{name:\"중국집\",img:dhspic},{name:\"덮밥\",img:dhspic}];var stringToTime=function stringToTime(str){var _str$split$map=str.split(':').map(function(el){return parseInt(el);}),_str$split$map2=_slicedToArray(_str$split$map,2),hour=_str$split$map2[0],minute=_str$split$map2[1];return hour*60+minute;};var restList=restInfo.filter(function(rest){var nowTime=new Date().getHours()*60+new Date().getMinutes();return stringToTime(rest.open)<=nowTime&&nowTime<=stringToTime(rest.close);}).map(function(rest,i){return/*#__PURE__*/React.createElement(\"li\",{key:i,style:{listStyle:'none'}},/*#__PURE__*/React.createElement(Link,{to:\"./restaurant/\".concat(rest.id)},/*#__PURE__*/React.createElement(RestCard,{restInfo:rest,roomInfo:roomInfo})));});var catList=catInfoList.map(function(cat,i){return/*#__PURE__*/React.createElement(\"li\",{key:i,style:{listStyle:'none'}},/*#__PURE__*/React.createElement(Link,{to:{pathname:\"./filter/\".concat(cat.name)}},\" \",/*#__PURE__*/React.createElement(CatItem,{img:cat.img,name:cat.name}),\" \"));});var _useState7=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState8=_slicedToArray(_useState7,2),myRoomCard=_useState8[0],setMyRoomCard=_useState8[1];var _useState9=useState(/*#__PURE__*/React.createElement(React.Fragment,null)),_useState10=_slicedToArray(_useState9,2),otherRoomList=_useState10[0],setOtherRoomList=_useState10[1];var _useParams=useParams(),userId=_useParams.userId;var navigate=useNavigate();function getRooms(){onSnapshot(collection(db,\"rooms\"),function(snapshot){var tmp=[];snapshot.forEach(function(doc){return tmp.push({room_id:doc.id,room:doc.data()});});setRoomInfo(tmp.map(function(_ref){var room=_ref.room,room_id=_ref.room_id;var roomInfoObj={'roomId':room_id,'restName':room.restName,'addr':room.addr,'ordStat':room.ordStat,'parti':room.parti,'endTime':room.endTime,'timeLeft':parseInt((room.endTime.seconds-new Date().getTime()/1000)/60),'rest':restInfo.filter(function(rest){return rest.name==room.restName;})[0],'poolMon':room.parti.reduce(function(money,menu){return money+menu.price;},0)};if(room.parti.filter(function(el){return el.id===userId;}).length!==0){setMyRoomCard(/*#__PURE__*/React.createElement(Link,{to:{pathname:\"./\".concat(room_id)}},\" \",/*#__PURE__*/React.createElement(RoomCard,{roomInfo:roomInfoObj,photo:true})));setOtherRoomList(/*#__PURE__*/React.createElement(React.Fragment,null));setIsUserParticipants(true);}return roomInfoObj;}));updateDoc(doc(db,\"users\",userId),{curRoomId:\"\"});});getDoc(doc(db,\"users\",userId)).then(function(user){if(user.data()!==undefined){var _user$data=user.data(),addr=_user$data.addr;if(addr===\"\"||addr===undefined){setDeliAddr(\"배달장소 선택\");}else{setDeliAddr(addr);}}});}useEffect(function(){getRooms();},[]);function handleRoomEnter(roomId,restName){updateDoc(doc(db,\"users\",userId),{curRoomId:roomId});var restId=restInfo.filter(function(_ref2){var name=_ref2.name;return name===restName;})[0].id;if(window.confirm(\"먼저 배달음식을 담아주세요\")){navigate(\"./restaurant/\".concat(restId));}console.log(roomId);}useEffect(function(){if(isUserParticipants){}else{console.log(roomInfo);setMyRoomCard(/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__noYourRoom\"},\"\\uC544\\uC9C1 \\uCC38\\uC5EC\\uD558\\uC2E0 \\uBC29\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"));setOtherRoomList(/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__title\"},\"Room Suggestions\"),/*#__PURE__*/React.createElement(\"ul\",{style:{margin:0},className:\"mainPage__room-list\"},roomInfo.filter(function(el){return el.addr===deliAddr;}).map(function(room,i){return/*#__PURE__*/React.createElement(\"li\",{key:i,style:{listStyle:'none'}},/*#__PURE__*/React.createElement(\"div\",{onClick:function onClick(){return handleRoomEnter(room.roomId,room.restName);}},\" \",/*#__PURE__*/React.createElement(RoomCard,{roomInfo:room,photo:true})));}))));}},[roomInfo,isUserParticipants,deliAddr]);useEffect(function(){if(deliAddr!==\"배달장소 선택\"&&deliAddr!==\"\"){updateDoc(doc(db,\"users\",userId),{addr:deliAddr});}},[deliAddr]);// [Not Solved] 근데 my room 이 생긴 상태의 사람은 suggestion 없애야할듯\n// for (const room of roomInfo) {\n//   room['rest'] = restInfo.filter((rest) => rest.name == room.restName)[0];\n// }\nreturn/*#__PURE__*/React.createElement(\"div\",{className:\"ui-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__\"},/*#__PURE__*/React.createElement(NavBar,{deliAddr:deliAddr,setDeliAddr:setDeliAddr}),/*#__PURE__*/React.createElement(\"div\",{style:{height:\"105px\"}}),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__title\"},\"Food Categories\"),/*#__PURE__*/React.createElement(\"ul\",{className:\"mainPage__cat-list\"},catList),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__title\"},\"Your Room\"),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__room-list\"},myRoomCard),otherRoomList,/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__separation\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"mainPage__title\"},\"Restaurant List\"),/*#__PURE__*/React.createElement(\"ul\",{style:{margin:0},className:\"mainPage__rest-card-list\"},restList)));}export default Main;","map":{"version":3,"sources":["/Users/HS/Documents/GitHub/dalguna/dalguna/dalguna/src/pages/Main.js"],"names":["React","useState","useEffect","Link","useParams","useNavigate","collection","onSnapshot","updateDoc","doc","getDoc","db","RoomCard","CatFilter","CatItem","RestCard","NavBar","TabBar","CartModal","staticDB","dhspic","Main","deliAddr","setDeliAddr","restInfo","roomInfo","setRoomInfo","isUserParticipants","setIsUserParticipants","catInfoList","name","img","stringToTime","str","split","map","el","parseInt","hour","minute","restList","filter","rest","nowTime","Date","getHours","getMinutes","open","close","i","listStyle","id","catList","cat","pathname","myRoomCard","setMyRoomCard","otherRoomList","setOtherRoomList","userId","navigate","getRooms","snapshot","tmp","forEach","push","room_id","room","data","roomInfoObj","restName","addr","ordStat","parti","endTime","seconds","getTime","reduce","money","menu","price","length","curRoomId","then","user","undefined","handleRoomEnter","roomId","restId","window","confirm","console","log","margin","height"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link, useParams, useNavigate } from \"react-router-dom\";\nimport { collection, onSnapshot, updateDoc, doc, getDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase-config.js\";\n\nimport RoomCard from '../components/RoomCard';\nimport CatFilter from './CatFilter';\nimport CatItem from '../components/CatItem';\nimport RestCard from '../components/RestCard.js'\nimport NavBar from '../components/NavBar.js'\nimport TabBar from '../components/TabBar.js'\nimport CartModal from \"../components/CartModal\";\n\nimport staticDB from \"../db/static.json\";\nimport dhspic from '../img/DHS_photo.jpeg';\n\nimport \"../main.css\";\n\nfunction Main() {\n  const [deliAddr, setDeliAddr] = useState(\"\");\n  const restInfo = staticDB;\n  const [roomInfo, setRoomInfo] = useState([]);\n  const [isUserParticipants, setIsUserParticipants] = useState(false);\n  const catInfoList = [\n    {name: \"한식\", img:dhspic}, \n    {name: \"일식\", img:dhspic},\n    {name: \"분식\", img:dhspic},\n    {name: \"아시아\", img:dhspic},\n    {name: \"샐러드\", img:dhspic},\n    {name: \"도시락\", img:dhspic},\n    {name: \"중국집\", img:dhspic},\n    {name: \"덮밥\", img:dhspic},\n  ]\n\n  const stringToTime = (str) => {\n    const [hour, minute] = str.split(':').map((el) => parseInt(el));\n    return hour * 60 + minute;\n  }\n  const restList = restInfo.filter((rest) => {\n    const nowTime = new Date().getHours() * 60 + new Date().getMinutes();\n    return stringToTime(rest.open) <= nowTime && nowTime <= stringToTime(rest.close);\n  }).map((rest, i) => \n  <li key={i} style={{listStyle:'none'}}>\n     <Link to={`./restaurant/${rest.id}`}><RestCard restInfo={rest} roomInfo={roomInfo}></RestCard></Link>\n  </li>)\n\n  const catList = catInfoList.map((cat, i) => \n      <li key={i} style={{listStyle:'none'}}>\n        <Link to={{\n          pathname:`./filter/${cat.name}`}}> <CatItem img={cat.img} name={cat.name}></CatItem> </Link>\n      </li>\n  )\n  \n  const [myRoomCard, setMyRoomCard] = useState(<></>);\n  const [otherRoomList, setOtherRoomList] = useState(<></>);\n  \n  const { userId } = useParams();\n  const navigate = useNavigate();\n\n  function getRooms() {\n    onSnapshot(collection(db, \"rooms\"), (snapshot) => {\n      const tmp = [];\n      snapshot.forEach((doc) => tmp.push({room_id: doc.id, room: doc.data()}))\n      setRoomInfo(tmp.map(({room, room_id}) => {\n        const roomInfoObj = {\n          'roomId': room_id, 'restName': room.restName,\n          'addr': room.addr, 'ordStat': room.ordStat,\n          'parti': room.parti, 'endTime': room.endTime,\n          'timeLeft': parseInt((room.endTime.seconds - new Date().getTime() / 1000) / 60),\n          'rest': restInfo.filter((rest) => rest.name == room.restName)[0],\n          'poolMon': room.parti.reduce((money, menu) => money + menu.price, 0) \n        }\n        if (room.parti.filter((el) => el.id === userId).length !== 0) {\n          setMyRoomCard(<Link to={{pathname:`./${room_id}`}}> <RoomCard roomInfo={roomInfoObj} photo={true}></RoomCard></Link>)\n          setOtherRoomList(<></>)\n          setIsUserParticipants(true);\n        }\n        return roomInfoObj}));\n      updateDoc(doc(db, \"users\", userId), {\n        curRoomId: \"\"\n      })\n    })\n\n    getDoc(doc(db, \"users\", userId)).then((user)=> {\n      if (user.data() !== undefined) {\n        const { addr } = user.data()\n        if (addr === \"\" || addr === undefined) {\n          setDeliAddr(\"배달장소 선택\")\n        } else {\n          setDeliAddr(addr)\n        }\n      }\n    })\n  }\n\n  useEffect(() => {\n    getRooms();\n  }, []);\n\n  function handleRoomEnter(roomId, restName) {\n    updateDoc(doc(db, \"users\", userId), {\n      curRoomId: roomId\n    })\n    const restId = restInfo.filter(({name}) => name === restName)[0].id\n    if (window.confirm(\"먼저 배달음식을 담아주세요\")) {\n      navigate(`./restaurant/${restId}`)\n    }\n    console.log(roomId)\n  }\n\n  useEffect(() => {\n    if (isUserParticipants) {}\n    else {\n      console.log(roomInfo, )\n      setMyRoomCard(<div className=\"mainPage__noYourRoom\">아직 참여하신 방이 없습니다.</div>)\n      setOtherRoomList(<>\n        <div className = \"mainPage__separation\"/>\n        <div className = \"mainPage__title\">Room Suggestions</div>\n        <ul style={{margin:0}} className = \"mainPage__room-list\">\n            {roomInfo.filter((el) => el.addr === deliAddr).map((room, i) => \n            <li key={i} style={{listStyle:'none'}}>\n                <div onClick={() => handleRoomEnter(room.roomId, room.restName)}> <RoomCard roomInfo={room} photo={true}></RoomCard></div>\n            </li>)}\n        </ul></>\n        )\n    }\n\n  }, [roomInfo, isUserParticipants, deliAddr])\n  \n  useEffect(() => {\n    if (deliAddr !== \"배달장소 선택\" && deliAddr !== \"\") {\n      updateDoc(doc(db, \"users\", userId), {\n        addr: deliAddr\n      })\n    }\n  }, [deliAddr])\n  \n  // [Not Solved] 근데 my room 이 생긴 상태의 사람은 suggestion 없애야할듯\n  // for (const room of roomInfo) {\n  //   room['rest'] = restInfo.filter((rest) => rest.name == room.restName)[0];\n  // }\n\n\n  return (\n    <div className=\"ui-container\">\n      <div className=\"mainPage__\">\n        <NavBar deliAddr={deliAddr} setDeliAddr={setDeliAddr}/>\n        <div style={{height:\"105px\"}}/>\n        <div className = \"mainPage__title\">Food Categories</div>\n        <ul className = \"mainPage__cat-list\">\n            {catList}\n        </ul>\n        <div className = \"mainPage__separation\"/>\n        <div className = \"mainPage__title\">Your Room</div>\n        <div className = \"mainPage__room-list\">\n            {myRoomCard}\n        </div>\n        {otherRoomList}\n        <div className = \"mainPage__separation\"/>\n        <div className = \"mainPage__title\">Restaurant List</div>\n        <ul style={{margin:0}} className = \"mainPage__rest-card-list\">\n            {restList}\n        </ul>\n        {/* <TabBar/> */}\n      </div>\n    </div>\n      \n  )\n}\n\nexport default Main;"]},"metadata":{},"sourceType":"module"}